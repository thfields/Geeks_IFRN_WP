(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{getSectionSlugFromPattern:()=>ee,initFirebaseData:()=>W,initializeGutentagPatterns:()=>T,normalizeCategorySlug:()=>Z,registerBlockVariationFromPreset:()=>U,registerPattern:()=>w,registerPatternCategory:()=>B,registerVariation:()=>v,sectionCategoryToLabel:()=>te});const n=window.kubio.constants,o=window.kubio.utils,i=window.wp.data,r=window.wp.hooks,a=window.lodash;var s=e.n(a);let l=null,c=null,u=null,d=null;const g="__experimentalBlockPatterns",f="__experimentalBlockPatternCategories",b="kubioBlockTags",p="kubioBlockPresets";let k=[],m=[],h=[],y=[];const v=(e,t)=>{const n=(0,i.select)("core/blocks").getBlockType(e),a=(null==n?void 0:n.variationsFilter)||s().identity;if(n&&n.isPro)return;const l=(0,r.applyFilters)("kubio.register-variation",a(t),n),{addBlockVariations:c}=(0,i.dispatch)("core/blocks");c(e,(0,o.normalizeVariation)(l)),(0,r.doAction)("kubio.variation-added",e,l,((e,t)=>{c(e,(0,o.normalizeVariation)(t))}))},S=new Event("kubioVariationLoaded",{bubbles:!0}),P=()=>{(0,i.dispatch)(n.SESSION_STORE_KEY).setProp(n.GLOBAL_SESSION_ID,"variations-loaded",!0),document.body.dispatchEvent(S),setTimeout((()=>{(0,r.doAction)("kubio.blockPatterns.variationsRegistered")}),5e3)},w=e=>{Array.isArray(e)||(e=[e]),l?l(e):e.forEach((e=>{k.push(e)}))},B=e=>{Array.isArray(e)||(e=[e]),c?c(e):e.forEach((e=>{m.push(e)}))},E=function(e,t){var n,o;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!t)return t;if((0,a.isEmpty)(r)&&"imagesData"===i&&"kubio/image-gallery"===e)return t.map((e=>{let{caption:t,alt:n,url:o}=e;return{caption:t,alt:n,url:o,id:0}}));if((0,a.isEmpty)(r)&&"kubioAI"===i&&null!==(n=t)&&void 0!==n&&null!==(o=n.meta)&&void 0!==o&&o.initialValues&&delete t.meta.initialValues,(0,a.isEmpty)(r)&&"id"===i&&"kubio/image"===e)return 0;if((0,a.isString)(t))return"content"===i&&(t=t.replaceAll('<meta charset="utf-8"></meta>',"")),t;if((0,a.isArray)(t)){for(let n=0;n<t.length;n++)t[n]=E(e,t[n],n,[...r,i].filter(Boolean));return t}if((0,a.isObject)(t)){for(const n in t)t[n]=E(e,t[n],n,[...r,i].filter(Boolean));return t}return t},O=e=>{const[t,n={},o=[]]=e,i=o.map(O);return[t,E(t,n),i]},_=s().debounce((()=>{const{updateSettings:e}=(0,i.dispatch)(n.STORE_KEY);l=(0,o.queueCall)((t=>{const o=(0,i.select)(n.STORE_KEY).getSettings(),r=o[g],l=(0,a.flatten)((0,a.flatten)(t)).map((e=>({...e,content:O(e.content)})));e({...o,[g]:s().uniqBy([...r,...l],"name")})}),500),c=(0,o.queueCall)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,i.select)(n.STORE_KEY).getSettings(),r=o[f],l=(0,a.flatten)((0,a.flatten)(t)),c=s().uniqBy([...l,...r],"name");e({...o,[f]:c})}),500),d=(0,o.queueCall)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,i.select)(n.STORE_KEY).getSettings(),r=o[p]||[],l=(0,a.flatten)((0,a.flatten)(t));e({...o,[p]:s().uniqBy([...r,...l],"name")})}),500),u=(0,o.queueCall)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const o=(0,i.select)(n.STORE_KEY).getSettings(),r=o[b]||[],l=(0,a.flatten)((0,a.flatten)(t));e({...o,[b]:s().uniqBy([...r,...l],"slug")})}),500),l(k),c(m),u(h),d(y),k=[],m=[],h=[],y=[],window.kubioPatternsRegistered=!0}),2e3),T=()=>{const e=(0,i.subscribe)((()=>{const{getProp:t}=(0,i.select)(n.SESSION_STORE_KEY);t(n.GLOBAL_SESSION_ID,"ready",!1)&&(e(),_())}))};(0,r.addFilter)("kubio.firebasePatterns.beforeRegisterPattern","kubioMetadata",(e=>{const t=e.content,n=e.categories[0]||"",o=t[1]||[],i="kubioAI.meta";return s().get(o,i)||s().set(o,i,{}),s().set(o,`${i}.category`,n.split("/")[1]),s().set(o,`${i}.cloudPresetId`,e.cloudPresetId),s().unset(o,"kubio.props.aiData.category"),e}));const A=window.kubio.adminPanel,I=window.kubio.blockLibrary,N=window.kubio.core,R=window.kubio.pro,C=window.wp.i18n,F=(0,I.getNamesOfBlocks)(),D=(0,I.getBlocksByName)(),L=(()=>{const e={};return s().each(D,((t,n)=>{const o=s().get(t,"settings.inheritBlock");o&&(Array.isArray(e[o])||(e[o]=[]),e[o].push(n))})),e})(),K=e=>s().get(D,e+".settings.title",""),V=e=>K(e),q=e=>K(e)+"(from default preset)",G={};top.kubioDefaultPresetByBlockName=G;const x=(e,t)=>n=>{const{value:i}=n;v(t,(0,o.refreshBlockStyleRefs)({name:t,isDefault:!0,title:V(t),description:q(t),attributes:{},innerBlocks:[i]}));const[,r,a]=i;G[e]=i,v(e,(0,o.refreshBlockStyleRefs)({name:e,isDefault:!0,title:V(e),description:q(e),attributes:r,innerBlocks:a}))},$={[F.BUTTON]:x(F.BUTTON,F.BUTTON_GROUP),[F.LINK]:x(F.LINK,F.LINK_GROUP)},Y=[F.SECTION,F.HERO,F.NAVIGATION],U=(e,t)=>{G[e]=t,v(e,(0,o.refreshBlockStyleRefs)({name:e,isDefault:!0,title:V(e),description:V(e),attributes:t[1],innerBlocks:t[2]}))},j=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];setTimeout(((e,t)=>{const{value:n}=e;if(s().has($,t))return $[t](e);U(t,n),L[t]&&L[t].forEach((e=>{U(e,n)}))}),1,...t)};function z(e){const t=s().get(D,e,{}),{template:n}=t;n&&(M(n[0]),v(e,(0,o.refreshBlockStyleRefs)({name:e,isDefault:!0,title:V(e),description:V(e),attributes:{},innerBlocks:n})))}function M(e){const t=s().get(e,"2",[]);t.forEach(((e,n)=>{"function"==typeof e?s().set(t,n,e()):M(e)}))}const J=e=>(null==e?void 0:e.internalTags)||[],H=window.kubioUtilsData.showShopContent,Q=["kubio-content/woocommerce","kubio-content/products"],W=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,A.initAdminStore)((async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const{sections:i,headers:l,footers:c,presets:g,cloudDefaults:f}=t;if((e=>{if(!e)return;(e=s().cloneDeep(e)).forEach((e=>{e.value=JSON.parse(e.value)}));const t={};e.forEach((e=>{t[e.component]=e})),s().each(t,j)})(f),setTimeout((()=>{Y.forEach(z),P()}),200),e)return;const b=[].concat(i,l,c).filter((e=>{const t=e.categorySlug;return!(!H&&Q.includes(t))})),p={},k=s().keyBy(n,"slug"),m=[],v=b.map((e=>{const t=e.categorySlug;p[t]=!0;const n=s().isString(e.value)?JSON.parse(e.value):e.value;let o;o=(e=>(0,R.isFreeVersion)()&&e.isPro)(e);const i={};null!=e&&e.context&&(i.context=e.context),null!=e&&e.filters&&(i.filters=e.filters);let a=s().get(e,"collections",[]);a=s().difference(a,["default"]);const l=(e=>(null==e?void 0:e.publicTags)||[])(e);l.forEach((e=>{m.includes(e)||m.push(e)}));let c={name:`${t}/${e.slug}/${e.id}`,title:e.name,categories:[t],slug:e.slug,collections:a,index:null==e?void 0:e.index,description:"Placeholder",screenshot:e.screenshot,fromFirebase:!0,isProPattern:null==e?void 0:e.isPro,isProOnFree:o,isGutentagPattern:!0,publicTags:l,internalTags:J(e),cloudPresetId:null==e?void 0:e.id,categoryCloudId:null==e?void 0:e.categoryId,fromColibri:!0,pairCloudPresetId:e.snippetPairId,content:n,...i};return c=(0,r.applyFilters)("kubio.firebasePatterns.beforeRegisterPattern",c),c}));let S=[];n.forEach((e=>{const t=e.slug,n=e.label;if(!p[t])return;let o={};const i=k[t];i&&(o={cloudId:null==i?void 0:i.id}),S.push({label:n,name:t,...o})})),S=(e=>{const t={label:(0,C.__)("Custom sections","kubio"),name:"kubio-content/custom"};return e.push(t),e})(S),((e,t)=>{const n=(0,N.composeBlockWithStyle)(F.SECTION,{},[]),o="kubio-content/blank",i={label:(0,C.__)("Blank","kubio"),name:o},r={name:`${o}/blank-section/9999`,slug:"blank-section",index:99999,title:(0,C.__)("Blank section","kubio"),categories:[o],description:(0,C.__)("Blank section","kubio"),screenshot:"https://content.colibriwp.com/screenshots/blank.png",fromColibri:!0,fromFirebase:!0,isProOnFree:!1,isGutentagPattern:!0,content:n,internalTags:[],publicTags:[]};e.push(r),t.push(i)})(v,S),B(S),w(v);const E=g.map((e=>{const t=(0,a.isString)(e.value)?JSON.parse(e.value):e.value;let n={...e,name:`${e.component}/${e.id}`,content:t,title:e.name,cloudPresetId:e.id};return n=(0,r.applyFilters)("kubio.firebasePatterns.beforeRegisterPreset",n),n}));var O;O=E,Array.isArray(O)||(O=[O]),d?d(O):O.forEach((e=>{y.push(e)}));const _=o.filter((e=>!!e.is_public&&m.includes(e.slug)));var T;T=_,Array.isArray(T)||(T=[T]),u?u(T):T.forEach((e=>{h.push(e)})),P()}))};var X;null!==(X=window.kubioBlockPatterns)&&void 0!==X&&X.inGutenbergEditor&&W(!0);const Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=e.replace(/\s\s+/,"-").replaceAll(" ","-"),t&&(e=e.replace(/[^a-z0-9\-]/gi,"")),e},ee=e=>{const t=((null==e?void 0:e.name)||"").split("/");return(0,a.get)(t,"2")},te=e=>{switch(e.toLowerCase()){case"hero-accent":e="Hero Accent";break;case"cta":e="Call to Action";break;case"f.a.q.":e="F.A.Q."}return(0,a.upperFirst)(e.replace(/-/gim," "))};(window.kubio=window.kubio||{}).blockPatterns=t})();
